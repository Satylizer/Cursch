from langchain_core.documents import Document
from config.config import ChromaDB
from rag_chain.rag_chain import RagChain
import shutil
import os

# --- полностью очищаем прошлую базу ---
DB_PATH = "./debug_chroma"
if os.path.exists(DB_PATH):
    shutil.rmtree(DB_PATH)

# --- инициализация ---
db = ChromaDB(DB_PATH)
rag = RagChain(db)

# --- документы ---
DOC_1 = """
В компании установлен стандартный ежегодный оплачиваемый отпуск продолжительностью 28 календарных дней для всех сотрудников.
Отпуск может быть взят полностью или разбит на несколько частей по согласованию с руководством.
Для оформления отпуска необходимо подать заявление на имя руководителя не позднее чем за 2 недели до предполагаемой даты начала отпуска.
В случае необходимости, сотрудник может запросить перенос отпуска на более поздний срок.

В случае болезни в период отпуска, он может быть продлен на количество дней, когда сотрудник был на больничном.
При увольнении сотрудника неиспользованные дни отпуска оплачиваются.
"""

DOC_2 = """
Больничный лист выдается в случае временной нетрудоспособности сотрудника по причине болезни или травмы.
Работодатель обязуется оплатить больничный с первого дня нетрудоспособности.

В случае длительного больничного сотрудник может получить пособие по временной нетрудоспособности.
Если сотрудник был в отпуске в период болезни, то отпуск может быть продлен.

Для оформления больничного листа сотрудник должен обратиться в медицинское учреждение.
"""

docs = [
    Document(page_content=DOC_1),
    Document(page_content=DOC_2),
]

added = rag.add_document(docs)
print(f"\nЗагружено чанков: {added}")

# --- вопросы ---
questions = [
    "Сколько дней отпуска положено сотруднику?",
    "Что происходит если сотрудник заболел в период отпуска?",
    "С какого дня оплачивается больничный?",
    "Как оформить больничный лист?"
]

# --- диалог с RAG ---
for q in questions:
    print("\n--------------------------------")
    print("Вопрос:", q)
    answer = rag.query(q)
    print("Ответ:", answer)
